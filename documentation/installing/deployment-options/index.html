<!DOCTYPE html>
<html class="no-js" lang="en-us">
  <head>
    <meta charset="utf-8">
    
    

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Alegreya+Sans+SC:400,700|Source+Sans+Pro:300,700&display=swap" >

    <meta http-equiv="X-UA-Compatible" content="IE=edge">
     
    <title> Architecture and deployment options | Microcks.io</title>

    <meta name="viewport" content="width=device-width,minimum-scale=1">
     <meta name="generator" content="Hugo 0.88.1" />

      
        <META NAME="ROBOTS" CONTENT="INDEX, FOLLOW">
      

    
    
      <link rel="stylesheet" href="/output/css/app.min.a42f770a563de5f4c7aa7d9babef2ebb3b19a040c7f605dbe8b506de79650df9.css" integrity="sha256-pC93ClY95fTHqn2bq&#43;8uuzsZoEDH9gXb6LUG3nllDfk=" crossorigin="anonymous"> 
          
    


    

    
  <script type="text/javascript" src="/output/js/app.1caa725adf6b3c0d83460e78ce17051642a329cbe9222b7eccefa8def7cd7559.js" integrity="sha256-HKpyWt9rPA2DRg54zhcFFkKjKcvpIit&#43;zO&#43;o3vfNdVk=" crossorigin="anonymous" defer></script>
      
 



<script async defer src="https://buttons.github.io/buttons.js"></script>

      
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#0594cb">
<meta name="theme-color" content="#ffffff">
<meta property="og:title" content="Architecture and deployment options" />
<meta property="og:description" content="Introduction Now that you have looked at the different installation methods of Microcks, you may want to have a high-level view of its architecture and deployment options. This page will go through these topics, showing the different choices and options you may have depending on your target environment.
High-level Architecture In its simplest form, Microcks architecture is made of 4 components which are:
 The Microcks main web application (also called webapp) that holds the UI resources as well as API endpoints, Its associated MongoDB database for holding your data such as the repository of APIs | Services and Tests, A Microcks Postman runtime (microcks-postman-runtime) that allows the execution of Postman Collection tests and calls back Microcks for storing results, A Keycloak instance that holds the authentication mechanisms and identity provider integration." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://microcks.io/documentation/installing/deployment-options/" /><meta property="article:section" content="documentation" />
<meta property="article:published_time" content="2020-12-15T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-03-14T00:00:00+00:00" />

<meta itemprop="name" content="Architecture and deployment options">
<meta itemprop="description" content="Introduction Now that you have looked at the different installation methods of Microcks, you may want to have a high-level view of its architecture and deployment options. This page will go through these topics, showing the different choices and options you may have depending on your target environment.
High-level Architecture In its simplest form, Microcks architecture is made of 4 components which are:
 The Microcks main web application (also called webapp) that holds the UI resources as well as API endpoints, Its associated MongoDB database for holding your data such as the repository of APIs | Services and Tests, A Microcks Postman runtime (microcks-postman-runtime) that allows the execution of Postman Collection tests and calls back Microcks for storing results, A Keycloak instance that holds the authentication mechanisms and identity provider integration."><meta itemprop="datePublished" content="2020-12-15T00:00:00+00:00" />
<meta itemprop="dateModified" content="2022-03-14T00:00:00+00:00" />
<meta itemprop="wordCount" content="1393">
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Architecture and deployment options"/>
<meta name="twitter:description" content="Introduction Now that you have looked at the different installation methods of Microcks, you may want to have a high-level view of its architecture and deployment options. This page will go through these topics, showing the different choices and options you may have depending on your target environment.
High-level Architecture In its simplest form, Microcks architecture is made of 4 components which are:
 The Microcks main web application (also called webapp) that holds the UI resources as well as API endpoints, Its associated MongoDB database for holding your data such as the repository of APIs | Services and Tests, A Microcks Postman runtime (microcks-postman-runtime) that allows the execution of Postman Collection tests and calls back Microcks for storing results, A Keycloak instance that holds the authentication mechanisms and identity provider integration."/>


      
        
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-152524664-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  
  gtag('config', 'UA-152524664-1', {'dimension1': 'microcks.io', 'dimension2': ''});



var trackOutboundLink = function(id, url) {
  gtag('event', 'click', {
    'event_category': 'outbound',
    'event_label': id,
    'transport_type': 'beacon',
    'event_callback': function(){document.location = url;}
  });
}

</script>

      
      
  </head>
  <body class="ma0 sans-serif bg-primary-color-light production">
    
<nav class="bg-primary-color-dark pv4 w-100" role="navigation">

  <div class="center flex-ns flex-wrap items-center justify-start mw9">

    <img src="/images/microcks-round.png" class="logo-img dn-ns dn-xs dib-l">

    <h1 class="dim f2 lh-solid mr0 ml6-l ml2-ns pl3-ns ml3-xs mv0 fem">
      <a href="https://microcks.io" class="link white">
        MICROCKS
      </a>
    </h1>
    
    <ul class="list ma0 pa0 dn dib-l ml-auto-l">
      
        <li class="f5 dib mr4 fem" role="menuitem">
            
          <a href="/news/" class="dim link light-silver">
            NEWS
              
            
            
          </a>
        </li>
      
        <li class="f5 dib mr4 fem" role="menuitem">
            
          <a href="/documentation/" class="dim link light-silver">
            DOCS
              
            
            
          </a>
        </li>
      
        <li class="f5 dib mr4 fem" role="menuitem">
            
          <a href="/blog/" class="dim link light-silver">
            BLOG
              
            
            
          </a>
        </li>
      
        <li class="f5 dib mr4 fem" role="menuitem">
            
          <a href="/resources/" class="dim link light-silver">
            RESOURCES
              
            
            
          </a>
        </li>
      
        <li class="f5 dib mr4 fem" role="menuitem">
            
          <a href="/community/" class="dim link light-silver">
            COMMUNITY
              
            
            
          </a>
        </li>
      
        <li class="f5 dib mr4 fem" role="menuitem">
            
          <a href="https://github.com/microcks/microcks" class="dim link light-silver">
            GITHUB
              
            
            
              <span class="pl1">
                <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="10" height="10" viewBox="0 0 32 32" class="fill-current v-base" aria-label="External Link">
<path d="M25.152 16.576v5.696q0 2.144-1.504 3.648t-3.648 1.504h-14.848q-2.144 0-3.648-1.504t-1.504-3.648v-14.848q0-2.112 1.504-3.616t3.648-1.536h12.576q0.224 0 0.384 0.16t0.16 0.416v1.152q0 0.256-0.16 0.416t-0.384 0.16h-12.576q-1.184 0-2.016 0.832t-0.864 2.016v14.848q0 1.184 0.864 2.016t2.016 0.864h14.848q1.184 0 2.016-0.864t0.832-2.016v-5.696q0-0.256 0.16-0.416t0.416-0.16h1.152q0.256 0 0.416 0.16t0.16 0.416zM32 1.152v9.12q0 0.48-0.352 0.8t-0.8 0.352-0.8-0.352l-3.136-3.136-11.648 11.648q-0.16 0.192-0.416 0.192t-0.384-0.192l-2.048-2.048q-0.192-0.16-0.192-0.384t0.192-0.416l11.648-11.648-3.136-3.136q-0.352-0.352-0.352-0.8t0.352-0.8 0.8-0.352h9.12q0.48 0 0.8 0.352t0.352 0.8z"></path>
</svg>

              </span>
            
          </a>
        </li>
      
    </ul>

    <div class="db dib-ns pl3 pl4-ns pl2-xs"><form id="site-search-form" action="" role="search">
  <fieldset class="bn ma0 pa0">
    <label class="clip" for="search-input">Search</label>
    <input type="search" id="search-input" class="needs-js bg-left bn f5 input-reset lh-solid mt3 mt0-ns pl4 pv2 w5 white fem" placeholder="Search the Docs" name="search-input" value="" style="background: transparent url('/images/icon-search.png') no-repeat 0 8px /16px 16px;">
  </fieldset>
</form>

</div>

    <span class="absolute mt0 pr3 right-0 top-0">
<a href="https://github.com/microcks" class="github-corner hidden-md-down" aria-label="View source on Github" rel="nofollow" target="_blank">
  <svg width="74" height="74" viewBox="0 0 250 250" style="fill:#fff;z-index:2000;color:#1a3932;mix-blend-mode:screen;position:absolute;top:0;border:0;right:0" aria-hidden="true">
    <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
    <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7
      120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9
      125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path>
    <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6
      C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0
      C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1
      C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4
      C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9
      C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5
      C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9
      L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body">
    </path>
  </svg>
</a>
</span>

  </div>
</nav>

    
    <main role="main" class="content-with-sidebar min-vh-100 pb7 pb0-ns">
      
  <article class="w-100 ph3 pb5">
    <div class="flex-l">
      <div class="order-2 w-100 w-20-l ph5-m ph0-l mb4 sticky">
<aside class="fixed-lTK mw5-l right-0 f6 bl-l b--moon-gray pv4 pv0-ns ph4-l nested-list-reset nested-links nested-copy-line-height">
	
		<p class="b">What's on this Page</p>
  	<nav id="TableOfContents">
  <ul>
    <li><a href="#introduction">Introduction</a></li>
    <li><a href="#high-level-architecture">High-level Architecture</a>
      <ul>
        <li><a href="#architecture-for-async-api">Architecture for Async API</a></li>
      </ul>
    </li>
    <li><a href="#deployment-options">Deployment Options</a>
      <ul>
        <li><a href="#everything-managed-by-microcks">Everything managed by Microcks</a></li>
        <li><a href="#partially-managed-by-microcks">Partially managed by Microcks</a></li>
      </ul>
    </li>
  </ul>
</nav>
	

	<div date-pref>
		
			<a href="https://microcks.io/documentation/installing/docker-compose/" class="dib f6 pl1 hover-bg-light-gray br-100" title="Installing with docker-compose ">
				<svg class="fill-current" height="30px" viewBox="0 0 24 24" width="30px" xmlns="http://www.w3.org/2000/svg">
    <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
    <path d="M0 0h24v24H0z" fill="none"/>
</svg>

			</a>
		

		
	</div>

</aside>
</div>
      <div class="order-1 w-60-l mw8 ph0 ph4-ns">
        <header class="flex-none w-100 bg-primary-color pv3 ph3">
  
  <h1 class="lh-title mb3 mv0 pt3 accent-color-light fem">Architecture and deployment options</h1>
</header>

<aside class="bw1 pt3 mt2 mid-gray b--mid-gray fn w-100">
  
  
</aside>



<div class="prose" id="prose">

<h2 id="introduction">Introduction</h2>
<p>Now that you have looked at the different installation methods of Microcks, you may want to have a high-level view of its architecture and deployment options. This page will go through these topics, showing the different choices and options you may have depending on your target environment.</p>
<h2 id="high-level-architecture">High-level Architecture</h2>
<p>In its simplest form, Microcks architecture is made of 4 components which are:</p>
<ul>
<li>The Microcks main web application (also called <code>webapp</code>) that holds the UI resources as well as API endpoints,</li>
<li>Its associated MongoDB database for holding your data such as the repository of <strong>APIs | Services</strong> and <strong>Tests</strong>,</li>
<li>A Microcks Postman runtime (<code>microcks-postman-runtime</code>) that allows the execution of Postman Collection tests and calls back Microcks for storing results,</li>
<li>A <a href="https://keycloak.org">Keycloak</a> instance that holds the authentication mechanisms and identity provider integration.</li>
</ul>
<p>The schema below illustrates this architecture and the relations between components. You&rsquo;ll see that users access the main <code>webapp</code> either from their browser to see the console or from the <a href="../../automating/cli">CLI</a> or any other application using the API endpoints.</p>
<img src="/images/architecture-simple.png" class="img-responsive"/>
<blockquote>
<p>For sake of simplicity we do not represent here the PostgreSQL (or other database) that may be associated with Keycloak.</p>
</blockquote>
<p>You can deploy this simple architecture whatever installation method you pick: from <a href="../docker-compose">Docker Compose</a> to fully featured <a href="../operator">Operator</a>.</p>
<h3 id="architecture-for-async-api">Architecture for Async API</h3>
<p>If you want to enable asynchronous API features, 2 additional components will be required:</p>
<ul>
<li>The Microcks Async Minion (<code>microcks-async-minion</code>) is a component responsible for publishing mock messages corresponding to <a href="../../using/asyncapi">AsyncAPI</a> definitions as well as testing asynchronous endpoints. It retrieves these definitions from Microcks <code>webapp</code> at startup and then listens to a Kafka topic for changes on these definitions,</li>
<li>An <a href="https://kafka.apache.org">Apache Kafka</a> broker that holds our private topic for changes and the public topics that will be used to publish mock messages by the <code>microcks-async-minion</code>.</li>
</ul>
<p>The schema below represents this full-featured architecture with connection to outer brokers. We represented Kafka ones (<code>X</code> broker) as well as brokers (<code>Y</code> and <code>Z</code>) from other protocols with respect to our roadmap. üòâ</p>
<img src="/images/architecture-full.png" class="img-responsive"/>
<blockquote>
<p>For sake of simplicity we do not represent here the Zookeeper ensemble that may be associated with Kafka.</p>
</blockquote>
<p>When deploying on Kubernetes you will have to use our <a href="../kubernetes">Helm Chart</a> or <a href="../operator">Operator</a> installation methods for that. This architecture can also be deployed using Docker Compose using the <code>docker-compose-async-addon</code> file as described in <a href="../docker-compose/#enabling-asynchronous-api-features">enabling asynchronous features</a>.</p>
<h2 id="deployment-options">Deployment Options</h2>
<p>At this point, you should have a better vision on Microcks architecture and should be wondering: should I deploy this as a monolith? Not at all, we provide different deployment options to better suit your environment.</p>
<h3 id="everything-managed-by-microcks">Everything managed by Microcks</h3>
<p>Of course - when starting from scratch - the simplest way of deploying Microcks is to use our <a href="../kubernetes">Helm Chart</a> or <a href="../operator">Operator</a> that will handle the setup of all required dependencies for you. All the components from the architecture are setup through community container images or operators like the excellent <a href="https://strimzi.io">Strimzi Operator</a>.</p>
<p>This setup makes things easy to start and easy to drop: everything is placed under a single Kubernetes namespace as illustrated into the schema below:</p>
<img src="/images/deployment-all-managed.png" class="img-responsive"/>
<blockquote>
<p>Helm Chart or Operator? I would say it depends&hellip; üòâ Operator will handle more complex lifecycle and update procedures as weel as tuning operations in the future. While Helm Chart will remain easier for simple &ldquo;throwable&rdquo; setup.</p>
</blockquote>
<h3 id="partially-managed-by-microcks">Partially managed by Microcks</h3>
<p>Besides this all-in-one approach, you may also use both installation methods to pick the components you want Microcks to install and the other existing ones you may want Microcks to connect to. You will have the following options:</p>
<ul>
<li>Do not deploy a MongoDB database and reuse an existing one. For that, put the <code>mongodb.install</code> flag to <code>false</code> and specify a <code>mongodb.url</code>, a <code>mongodb.database</code> as well as credentials and that&rsquo;s it!</li>
<li>Do not deploy a Keycloak instance and reuse an existing one. For that, put the <code>keycloak.install</code> flag to <code>false</code> and specify a <code>keycloak.url</code> and a <code>keycloak.realm</code> and that&rsquo;s it! Optionally, you may want to specify a <code>keycloak.privateUrl</code> so that security token trusting will be done without hopping through a publicly reachable URL.</li>
<li>Do not deploy a Kafka instance and reuse an existing one. For that, put the <code>kafka.install</code> flag to <code>false</code> and specify a <code>kafka.url</code> and that&rsquo;s it!</li>
</ul>
<img src="/images/deployment-partially-managed.png" class="img-responsive"/>
<blockquote>
<p>Reusing already deployed components may allow you to lower operational costs if you&rsquo;re using shared instances. It can also allow you to use managed services that may be provided by your favorite cloud vendor.</p>
</blockquote>
<h4 id="reusing-existing-keycloak">Reusing existing Keycloak</h4>
<p>Microcks Helm Chart and Operator can also be configured to reuse an already existing Keycloak instance for your organization.</p>
<p>First, you have to prepare your Keycloak instance to host and secure future Microcks deployment. Basically you have 2 options for this:</p>
<ul>
<li><strong>Create a new realm</strong> using <a href="https://www.keycloak.org/docs/latest/server_admin/#proc-creating-a-realm_server_administration_guide">Keycloak documentation</a> and choosing <a href="https://github.com/microcks/microcks/raw/master/install/keycloak-microcks-realm-full.json">Microcks realm full configuration</a> as the file to import during creation,</li>
<li>OR <strong>Re-use an existing realm</strong>, completing its definition with <a href="https://github.com/microcks/microcks/blob/master/install/keycloak-microcks-realm-addons.json">Microcks realm addons configuration</a> by simply importing this file within realm configuration.</li>
</ul>
<p>Importing one or another of the Microcks realm configuration file will bring all the necessary clients, roles, groups and scope mappings. If you created a new realm, the Microcks configuration also brings default users you may later delete when configuring your <a href="https://www.keycloak.org/docs/latest/server_admin/#_identity_broker">own identity provider in Keycloak</a>.</p>
<p>Then, you actually have to deploy the Microcks instance configured for using external Keycloak. Depending whether you&rsquo;ve used Helm or Operator to install Microcks, you&rsquo;ll have to customize your <code>values.yml</code> file or the <code>MicrocksInstall</code> custom resource but the properties have the same names in both installation methods:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">keycloak</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">install</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span><span class="w">  </span><span class="nt">realm</span><span class="p">:</span><span class="w"> </span><span class="l">my-own-realm</span><span class="w">
</span><span class="w">  </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">keycloak.example.com:443</span><span class="w">
</span><span class="w">  </span><span class="nt">privateUrl</span><span class="p">:</span><span class="w"> </span><span class="l">http://keycloak.namespace.svc.cluster.local:8080/auth </span><span class="w"> </span><span class="c"># Optional</span><span class="w">
</span><span class="w">  </span><span class="nt">serviceAccount</span><span class="p">:</span><span class="w"> </span><span class="l">microcks-serviceaccount</span><span class="w">
</span><span class="w">  </span><span class="nt">serviceAccountCredentials</span><span class="p">:</span><span class="w"> </span><span class="l">ab54d329-e435-41ae-a900-ec6b3fe15c54   </span><span class="w"> </span><span class="c"># Change recommended</span><span class="w">
</span></code></pre></div><p>The <code>privateUrl</code> is optional and will allow to prevent trusting requests from <code>webapp</code> component to Keycloak to go through a public address and network. In a Kubernetes -deployment, you&rsquo;ll typically put there the cluster internal <code>Service</code> name.</p>
<p>The <code>serviceAccountCredentials</code> should typically be changed as this is the default value that comes with your realm setup. For an introduction on the purpose of service accounts in Microcks, check <a href="../../automating/service-account/">this page</a>.</p>
<h4 id="reusing-existing-kafka">Reusing existing Kafka</h4>
<p>Whilst it may seem obvious to certain people, it can be useful to recall that Microcks-Kafka interactions are not tied to a particular Kafka vendor. Whatever your Kafka vendor or your different Kafka vendors - be it vanilla Kafka, Confluent platform, Amazon MSK or Red Hat AMQ - Microcks will be able to connect and use them.</p>
<h5 id="for-mocking-purposes">For mocking purposes</h5>
<p>In that case, Kafka is used by both the <code>webapp</code> component to publish updates of API and the <code>microcks-async-minion</code> to publish mock messages.</p>
<p>Depending whether you&rsquo;ve used Helm or Operator to install Microcks, you&rsquo;ll have to customize your <code>values.yml</code> file or the <code>MicrocksInstall</code> custom resource but the properties have the same names in both installation methods.</p>
<p>To reuse an external Kafka cluster, here are the basic properties you&rsquo;ll have to change:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">features</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">async</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">kafka</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">install</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span><span class="w">      </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">my-kafka-cluster-bootstrap.example.com:443</span><span class="w">
</span></code></pre></div><p>As of today, Microcks supports connecting to SASL using JAAS and Mutual TLS secured Kafka brokers. For an introduction on these, please check <a href="https://docs.confluent.io/platform/current/kafka/overview-authentication-methods.html">Authentication Methods</a>.</p>
<p>For SASL using JAAS, you&rsquo;ll have to configure additional properties for accessing cluster CA cert and depending on SASL mechanism. The <code>truststoreSecrefRef</code> is actually a reference to a Kubernetes <code>Secret</code> that should be created first and reachable from Microcks instance:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">features</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">async</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">kafka</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">authentication</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">SASL_SSL           </span><span class="w"> </span><span class="c"># SASL using JAAS authentication</span><span class="w">
</span><span class="w">        </span><span class="nt">truststoreType</span><span class="p">:</span><span class="w"> </span><span class="l">PKCS12   </span><span class="w"> </span><span class="c"># JKS also possible.</span><span class="w">
</span><span class="w">        </span><span class="nt">truststoreSecretRef</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="nt">secret</span><span class="p">:</span><span class="w"> </span><span class="l">my-kafka-cluster-ca-cert  </span><span class="w"> </span><span class="c"># Name of Kubernetes secret holding cluster ca cert.</span><span class="w">
</span><span class="w">          </span><span class="nt">storeKey</span><span class="p">:</span><span class="w"> </span><span class="l">ca.p12                  </span><span class="w"> </span><span class="c"># Truststore ca cert entry in Secret.</span><span class="w">
</span><span class="w">          </span><span class="nt">passwordKey</span><span class="p">:</span><span class="w"> </span><span class="l">ca.password          </span><span class="w"> </span><span class="c"># Truststore password entry in Secret.</span><span class="w">
</span><span class="w">        </span><span class="nt">saslMechanism</span><span class="p">:</span><span class="w"> </span><span class="l">SCRAM-SHA-512</span><span class="w">
</span><span class="w">        </span><span class="nt">saslJaasConfig</span><span class="p">:</span><span class="w"> </span><span class="l">org.apache.kafka.common.security.scram.ScramLoginModule required username=&#34;scram-user&#34; password=&#34;tDtDCT3pYKE5&#34;;</span><span class="w">
</span></code></pre></div><p>For mutual TLS, you&rsquo;ll have to configuration additional properties for accessing the client certificate. The <code>keystoreSecretRef</code> is actually a reference to a Kubernetes <code>Secret</code> that should be created first and reachable from Microcks instance:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">features</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">async</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">kafka</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">authentication</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">SSL                </span><span class="w"> </span><span class="c"># Mutual TLS authentication</span><span class="w">
</span><span class="w">        </span><span class="nt">truststoreType</span><span class="p">:</span><span class="w"> </span><span class="l">PKCS12   </span><span class="w"> </span><span class="c"># JKS also possible.</span><span class="w">
</span><span class="w">        </span><span class="nt">truststoreSecretRef</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="nt">secret</span><span class="p">:</span><span class="w"> </span><span class="l">my-kafka-cluster-ca-cert  </span><span class="w"> </span><span class="c"># Name of Kubernetes secret holding cluster ca cert.</span><span class="w">
</span><span class="w">          </span><span class="nt">storeKey</span><span class="p">:</span><span class="w"> </span><span class="l">ca.p12                  </span><span class="w"> </span><span class="c"># Truststore ca cert entry in Secret.</span><span class="w">
</span><span class="w">          </span><span class="nt">passwordKey</span><span class="p">:</span><span class="w"> </span><span class="l">ca.password          </span><span class="w"> </span><span class="c"># Truststore password entry in Secret.</span><span class="w">
</span><span class="w">        </span><span class="nt">keystoreType</span><span class="p">:</span><span class="w"> </span><span class="l">PKCS12     </span><span class="w"> </span><span class="c"># JKS also possible.</span><span class="w">
</span><span class="w">        </span><span class="nt">keystoreSecretRef</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="nt">secret</span><span class="p">:</span><span class="w"> </span><span class="l">my-mtls-user       </span><span class="w"> </span><span class="c"># Name of Kubernetes secret holding user client cert.</span><span class="w">
</span><span class="w">          </span><span class="nt">storeKey</span><span class="p">:</span><span class="w"> </span><span class="l">user.p12         </span><span class="w"> </span><span class="c"># Keystore client cert entry in Secret.</span><span class="w">
</span><span class="w">          </span><span class="nt">passwordKey</span><span class="p">:</span><span class="w"> </span><span class="l">user.password </span><span class="w"> </span><span class="c"># Keystore password entry in Secret.</span><span class="w">
</span></code></pre></div><blockquote>
<p>We recommend having a in-depth look at the <a href="https://github.com/microcks/microcks/tree/master/install/kubernetes">Helm Chart README</a> and the <a href="https://github.com/microcks/microcks-ansible-operator">Operator README</a> to get the most up-to-date informations on detailed configuration.</p>
</blockquote>
<h5 id="for-testing-purposes">For testing purposes</h5>
<p>In that case, Kafka is considered as source for testing your event-driven API. We will just need 2 parameters specified at test launch-time for that:</p>
<ul>
<li><code>testEndpointUrl</code>: a connection string to a remote broker including destination and authentication options,</li>
<li><code>testSecret</code>: a Secret provided by Microcks administrator that will provide authentication credentials such as user, password and certificates.</li>
</ul>
<p>The schema below illustrates non exhaustive options:</p>
<img src="/images/deployment-brokers.png" class="img-responsive"/>

</div>

        

      </div>
      <div class="order-0 w-20 dn db-l mt4 ph3">
        
<nav role="navigation">
  <ul class="list pa0 nl2">
    
      
      <li class="f5 w-100 hover-bg-light-gray hover-accent-color-light fw8">
        <a href="javascript:void(0)" class="js-toggle dib w-100 link mid-gray hover-accent-color-light pl2 pr2 pv2 " data-target=".using">USING</a>
        <ul class="using desktopmenu animated fadeIn list pl0 bg-light-gray dn">
          <li class="f6 fw4">
            <a href="/documentation/getting-started/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              GETTING STARTED
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/documentation/getting-started-tests/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              GETTING STARTED WITH TESTS
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/documentation/using/importers/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              IMPORTING SERVICES &amp; APIS
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/documentation/using/alternatives/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              COMPARISON TO ALTERNATIVES
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/documentation/using/openapi/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              OPENAPI USAGE FOR MICROCKS
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/documentation/using/asyncapi/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              ASYNCAPI USAGE FOR MICROCKS
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/documentation/using/postman/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              POSTMAN USAGE FOR MICROCKS
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/documentation/using/grpc/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              GRPC USAGE FOR MICROCKS
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/documentation/using/graphql/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              GRAPHQL USAGE FOR MICROCKS
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/documentation/using/soapui/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              SOAPUI USAGE FOR MICROCKS
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/documentation/using/mocks/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              USING EXPOSED MOCKS
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/documentation/using/dynamic/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              GETTING DYNAMIC MOCKS
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/documentation/using/tests/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              EXECUTING TESTS
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/documentation/using/advanced/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              ADVANCED TOPICS
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/documentation/using/advanced/organizing/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              ORGANIZING REPOSITORY
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/documentation/using/advanced/templates/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              TEMPLATING MOCK RESPONSES
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/documentation/using/advanced/dispatching/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              CUSTOM DISPATCHING RULES
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/documentation/using/advanced/metadata/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              MICROCKS APIMETADATA
            </a>
          </li>
        </ul>
      </li>
      
      <li class="f5 w-100 hover-bg-light-gray hover-accent-color-light fw8">
        <a href="javascript:void(0)" class="js-toggle dib w-100 link mid-gray hover-accent-color-light pl2 pr2 pv2  accent-color-light" data-target=".installing">INSTALLING</a>
        <ul class="installing desktopmenu animated fadeIn list pl0 bg-light-gray db">
          <li class="f6 fw4">
            <a href="/documentation/installing/kubernetes/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              INSTALLING ON KUBE USING HELM
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/documentation/installing/operator/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              INSTALLING ON KUBE USING OPERATOR
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/documentation/installing/docker-compose/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              INSTALLING WITH DOCKER-COMPOSE
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/documentation/installing/podman-compose/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              INSTALLING WITH PODMAN-COMPOSE
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/documentation/installing/deployment-options/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 accent-color-light ">
              ARCHITECTURE AND DEPLOYMENT OPTIONS
            </a>
          </li>
        </ul>
      </li>
      
      <li class="f5 w-100 hover-bg-light-gray hover-accent-color-light fw8">
        <a href="javascript:void(0)" class="js-toggle dib w-100 link mid-gray hover-accent-color-light pl2 pr2 pv2 " data-target=".automating">AUTOMATING</a>
        <ul class="automating desktopmenu animated fadeIn list pl0 bg-light-gray dn">
          <li class="f6 fw4">
            <a href="/documentation/automating/service-account/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              MICROCKS SERVICE ACCOUNTS
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/documentation/automating/jenkins/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              INTEGRATING MICROCKS FROM JENKINS
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/documentation/automating/cli/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              CLI FOR MICROCKS
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/documentation/automating/tekton/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              USING MICROCKS FROM TEKTON
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/documentation/automating/github-actions/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              USING MICROCKS FROM GITHUB ACTIONS
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/documentation/automating/api/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              MICROCKS API
            </a>
          </li>
        </ul>
      </li>
      
      <li class="f5 w-100 hover-bg-light-gray hover-accent-color-light fw8">
        <a href="javascript:void(0)" class="js-toggle dib w-100 link mid-gray hover-accent-color-light pl2 pr2 pv2 " data-target=".administrating">ADMINISTRATING</a>
        <ul class="administrating desktopmenu animated fadeIn list pl0 bg-light-gray dn">
          <li class="f6 fw4">
            <a href="/documentation/administrating/users/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              MANAGING USERS
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/documentation/administrating/secrets/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              EXTERNAL SECRETS
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/documentation/administrating/snapshots/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              REPOSITORY SNAPSHOTS
            </a>
          </li>
        </ul>
      </li>
      
      <li class="f5 w-100 hover-bg-light-gray hover-accent-color-light fw8 mb1 bb b--moon-gray">
        <a href="javascript:void(0)" class="js-toggle dib w-100 link mid-gray hover-accent-color-light pl2 pr2 pv2 " data-target=".guides">GUIDES</a>
        <ul class="guides desktopmenu animated fadeIn list pl0 bg-light-gray dn">
          <li class="f6 fw4">
            <a href="/documentation/guides/openapi-101/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              OPENAPI MOCKING 101
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/documentation/guides/avro-messaging/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              KAFKA, AVRO AND SCHEMA REGISTRY
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/documentation/guides/mqtt-support/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              MQTT MOCKING AND TESTING
            </a>
          </li>
        </ul>
      </li>
      
      <li class="f5 w-100 hover-bg-light-gray hover-accent-color-light fw8">
        <a href="/resources/" class="js-toggle dib w-100 link mid-gray hover-accent-color-light pl2 pr2 pv2 " data-target=".resources">RESOURCES</a>
      </li>
      
      <li class="f5 w-100 hover-bg-light-gray hover-accent-color-light fw8">
        <a href="/community/" class="js-toggle dib w-100 link mid-gray hover-accent-color-light pl2 pr2 pv2 " data-target=".community">COMMUNITY</a>
      </li>
  </ul>
</nav>

      </div>
    </div>

  </article>
  

  <div class="w-100 bg-light-gray">
    <div class="mw7 pa4 center nested-lh-copy lh-copy">
      <h6 class="f4 dark-gray mb2">
  <a href="https://microcks.io/documentation/installing/deployment-options/" class="hide-child link primary-color">
  <span class="nl3 child"><svg class="grow" fill="" height="14px" viewBox="0 0 24 24" width="14px" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/></svg>
</span>
    ‚ÄúArchitecture and deployment options‚Äù
  </a> was last updated: March 14, 2022
</h6>

      <a href="https://github.com/microcks/microcks.io/edit/master/content/documentation/installing/deployment-options.md" class="
f6 ph3 pv1 br2 dib  tc ttu mv3 bg-primary-color white hover-bg-green link
">Improve this page</a>

      


    </div>
  </div>

    </main>

    <footer class="bg-primary-color-dark ph4-ns pt4 relative w-100" role="contentinfo">
    <div class="center flex-ns flex-wrap justify-between mw9 w-90">
      <div class="pb3 pt4 w-100 w-50-ns">

         <div class="b f3  light-gray mb3 nested-links tc">
           By the <a href="https://github.com/microcks/microcks/graphs/contributors" class="link">Microcks Authors</a><br />
          </div>

          <ul class="center f6 list ma0 mv3 pa0 tc"></ul>

          <ul class="center f6 list ma0 mv4 pa0 tc">
            <li class="dib mr3"><a href="https://twitter.com/microcksIO" class="dim link light-gray pv2">@MicrocksIO</a></li>
            <li class="dib mr3"><a href="https://twitter.com/lbroudoux" class="dim link light-gray pv2">@lbroudoux</a></li>
            
          </ul>

          

      </div>

       
      
      <div class="pb3 pt4 w-100 w-50-ns">
        <div class="b f3 light-gray mb3 nested-links tc">
          Join our <a href="https://microcksio.zulipchat.com" target="new" class="link">Community Chat</a><br/>
          <img src="/images/zulip.png" class="center h3 br3 mt3"/>
        </div>

      </div>
    </div>

    <div class="f7 gray mb5 mb0-ns ph3 w-100">
      <p class="dib mr4">
        The Microcks logos are copyright ¬© Laurent Broudoux 2016‚Äì2022. <br/>
        Icons by Made x Made from the Noun Project.<br/>
      </p>
    </div>

    
    
    

    <div class="bg-primary-color-dark bottom-0 left-0 right-0 dn-l fixed pb3 ph3 w-100"><div  class="globalmenu mobilemenu pb3 dn">
    

<ul class="list hidden dib ph0 ma0 scrolling-touch tc">
  
    <li  class="tl dib ma0 hover-bg-black w-100">
        <a href="/news/" class="ttu f6 link primary-color-light overflow hover-white db brand-font  ma0 w-100 pv3 ph4">
          News
        </a>
    </li>
  
    <li  class="tl dib ma0 hover-bg-black w-100">
        <a href="/documentation/" class="ttu f6 link primary-color-light overflow hover-white db brand-font  ma0 w-100 pv3 ph4">
          Docs
        </a>
    </li>
  
    <li  class="tl dib ma0 hover-bg-black w-100">
        <a href="/blog/" class="ttu f6 link primary-color-light overflow hover-white db brand-font  ma0 w-100 pv3 ph4">
          Blog
        </a>
    </li>
  
    <li  class="tl dib ma0 hover-bg-black w-100">
        <a href="/resources/" class="ttu f6 link primary-color-light overflow hover-white db brand-font  ma0 w-100 pv3 ph4">
          Resources
        </a>
    </li>
  
    <li  class="tl dib ma0 hover-bg-black w-100">
        <a href="/community/" class="ttu f6 link primary-color-light overflow hover-white db brand-font  ma0 w-100 pv3 ph4">
          Community
        </a>
    </li>
  
    <li  class="tl dib ma0 hover-bg-black w-100">
        <a href="https://github.com/microcks/microcks" class="ttu f6 link primary-color-light overflow hover-white db brand-font  ma0 w-100 pv3 ph4">
          GitHub
        </a>
    </li>
  
</ul>

</div>
<div  class="docsmenu mobilemenu pb3 dn">
    

<ul class="list dib ph0 ma0 scrolling-touch tc">
  
    <li  class="tl dib ma0 hover-bg-black w-100">
        <a href="/documentation//using/" class="ttu f6 link primary-color-light  hover-white db brand-font mb1  ma0 w-100 pv2 ph4">
          Using
        </a>
    </li>
  
    <li  class="tl dib ma0 hover-bg-black w-100">
        <a href="/documentation//installing/" class="ttu f6 link primary-color-light  hover-white db brand-font mb1  ma0 w-100 pv2 ph4">
          Installing
        </a>
    </li>
  
    <li  class="tl dib ma0 hover-bg-black w-100">
        <a href="/documentation//automating/" class="ttu f6 link primary-color-light  hover-white db brand-font mb1  ma0 w-100 pv2 ph4">
          Automating
        </a>
    </li>
  
    <li  class="tl dib ma0 hover-bg-black w-100">
        <a href="/documentation//administrating/" class="ttu f6 link primary-color-light  hover-white db brand-font mb1  ma0 w-100 pv2 ph4">
          Administrating
        </a>
    </li>
  
    <li  class="tl dib ma0 hover-bg-black w-100 mb2 bb b--mid-gray">
        <a href="/documentation//guides/" class="ttu f6 link primary-color-light  hover-white db brand-font mb1  ma0 w-100 pv2 ph4">
          Guides
        </a>
    </li>
  
    <li  class="tl dib ma0 hover-bg-black w-100">
        <a href="/documentation//resources/" class="ttu f6 link primary-color-light  hover-white db brand-font mb1  ma0 w-100 pv2 ph4">
          Resources
        </a>
    </li>
  
    <li  class="tl dib ma0 hover-bg-black w-100">
        <a href="/documentation//community/" class="ttu f6 link primary-color-light  hover-white db brand-font mb1  ma0 w-100 pv2 ph4">
          Community
        </a>
    </li>
  
</ul>

</div>

<div class="flex dn-l justify-between pt3-xs">
  <button class="js-toggle flex-auto dib dn-l f6 tc db mt4-ns ph3 pv2 link mr2 white bg-primary-color-dark hover-bg-primary-color ba b--white-40 w-auto" data-target=".globalmenu">Menu</button>

  <button class="js-toggle flex-auto dib dn-l f6 tc db mt4-ns ph3 pv2 link white bg-primary-color-dark hover-bg-primary-color ba b--white-40 w-auto" data-target=".docsmenu">Docs Menu</button>
</div>
</div>

</footer>

    

  </body>
</html>
